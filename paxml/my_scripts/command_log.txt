# 启动ray server
gcloud compute tpus tpu-vm ssh llm-jax-v3-32 --zone=us-east1-d --worker=0 --command="/home/lishengping/miniconda3/bin/ray start --head --port=3333 --resources='{\"tpu\": 1}'"  --project=llm-tpu
# vpn
sudo apt-get update && apt-get dist-upgrade
wget https://git.io/vpnsetup -O vpnsetup.sh && sudo \
VPN_IPSEC_PSK='lisen' \
VPN_USER='lisen' \
VPN_PASSWORD='lisen' sh vpnsetup.sh

重启服务
sudo service ipsec restart && sudo service xl2tpd restart

查看连接客户端
sudo ipsec whack --trafficstatus

查看连接日志
tail -F /var/log/auth.log | grep pluto

查看服务状态
sudo ipsec status
sudo ipsec verify

sudo iptables -A INPUT -p tcp --dport 12345 -j ACCEPT
sudo iptables -A OUTPUT -p tcp --sport 12345 -j ACCEPT



# v4 PilePythia7B256x1DynWFFN16HD128Win256Alignedv4
TPU_NAME=llm-jax-v4-32-10
ZONE=us-central2-b
STEP=33000
gcloud compute tpus tpu-vm ssh $TPU_NAME  --project=llm-tpu --worker all  --zone $ZONE --command="cd /home/lishengping/;sudo rm -r projects/*; cd projects; git clone -b xd/dev https://github.com/xiaoda99/paxml.git;git clone -b xd/dev https://github.com/xiaoda99/praxis.git"
gcloud compute tpus tpu-vm scp c4.py $TPU_NAME:/home/lishengping/projects/paxml/paxml/tasks/lm/params/c4.py  --zone=$ZONE  --worker=all  --project=llm-tpu




Pile v3-64-10  12B
TPU_NAME=llm-jax-v3-64-10
STEP=33000
ZONE=us-east1-d
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="cd /home/lishengping/;sudo rm -r projects/*; git clone -b pythia https://github.com/Lisennlp/paxml_praxis.git;mv paxml_praxis/*  projects/;rm -r paxml_praxis;killall main.py"
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="killall main.py;/home/lishengping/miniconda3/bin/python /home/lishengping/projects/paxml/paxml/main.py --exp=tasks.lm.params.c4.Pythia12BPileEval --job_log_dir=gs://llm_base_models/pythia/pythia-6.9b-paxml/ 2>&1 --enable_checkpoint_saving=False --eval_on_test=True| tee Pythia12BPileEval.Step$STEP.log"

Pile v3-64-13  12B
TPU_NAME=llm-jax-v3-64-13
STEP=43000
ZONE=us-east1-d
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="cd /home/lishengping/;sudo rm -r projects/*; git clone -b pythia https://github.com/Lisennlp/paxml_praxis.git;mv paxml_praxis/*  projects/;rm -r paxml_praxis;killall main.py"
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="killall main.py;/home/lishengping/miniconda3/bin/python /home/lishengping/projects/paxml/paxml/main.py --exp=tasks.lm.params.c4.Pythia12BPileEval --job_log_dir=gs://llm_base_models/pythia/pythia-6.9b-paxml/ 2>&1 --enable_checkpoint_saving=False --eval_on_test=True| tee Pythia12BPileEval.Step$STEP.log"


FlanMini v3-64-12  7B
TPU_NAME=llm-jax-v3-64-12
STEP=3000
ZONE=us-east1-d
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="cd /home/lishengping/;sudo rm -r projects/*; git clone -b pythia https://github.com/Lisennlp/paxml_praxis.git;mv paxml_praxis/*  projects/;rm -r paxml_praxis;killall main.py"
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="killall main.py;/home/lishengping/miniconda3/bin/python /home/lishengping/projects/paxml/paxml/main.py --exp=tasks.lm.params.c4.Pythia7BFlanMiniEval --job_log_dir=gs://llm_base_models/pythia/pythia-6.9b-paxml/ 2>&1 --enable_checkpoint_saving=False --eval_on_test=True| tee Pythia7BFlanMiniEval.Step$STEP.log"


FlanMini v3-64-11  12B
TPU_NAME=llm-jax-v3-64-11
STEP=3000
ZONE=us-east1-d
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="cd /home/lishengping/;sudo rm -r projects/*; git clone -b pythia https://github.com/Lisennlp/paxml_praxis.git;mv paxml_praxis/*  projects/;rm -r paxml_praxis;killall main.py"
gcloud compute tpus tpu-vm ssh $TPU_NAME --zone=$ZONE --worker=all --command="killall main.py;/home/lishengping/miniconda3/bin/python /home/lishengping/projects/paxml/paxml/main.py --exp=tasks.lm.params.c4.Pythia12BFlanMiniEval --job_log_dir=gs://llm_base_models/pythia/pythia-6.9b-paxml/ 2>&1 --enable_checkpoint_saving=False --eval_on_test=True| tee Pythia12BFlanMiniEval.Step$STEP.log"
